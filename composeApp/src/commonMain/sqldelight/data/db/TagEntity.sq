-- 将 Tag.sq 重命名为 TagEntity.sq
CREATE TABLE tag_entity (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL UNIQUE
);

CREATE TABLE poem_tag_relation (
    poetry_id INTEGER NOT NULL,
    tag_id INTEGER NOT NULL,
    PRIMARY KEY (poetry_id, tag_id),
    FOREIGN KEY (poetry_id) REFERENCES poem_entity(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES tag_entity(id) ON DELETE CASCADE
);

-- 查询诗词的标签
getTagsForPoetry:
SELECT t.*
FROM tag_entity t
JOIN poem_tag_relation pt ON t.id = pt.tag_id
WHERE pt.poetry_id = ?;

-- 查询标签的诗词
getPoetryForTag:
SELECT p.*
FROM poem_entity p
JOIN poem_tag_relation pt ON p.id = pt.poetry_id
WHERE pt.tag_id = ?;

-- 插入标签
insertTag:
INSERT INTO tag_entity(name) VALUES (?);

-- 按名称查询标签
selectByName:
SELECT *
FROM tag_entity
WHERE name = ?;

-- 将标签添加到诗词
addTagToPoetry:
INSERT INTO poem_tag_relation(poetry_id, tag_id) VALUES (?, ?);

-- 从诗词中移除标签
removeTagFromPoetry:
DELETE FROM poem_tag_relation
WHERE poetry_id = ? AND tag_id = ?; 